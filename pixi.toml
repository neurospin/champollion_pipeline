[workspace]
name = "champollion-pipeline"
version = "0.1.0"
description = "Installation of the Champollion V1 pipeline using Pixi"
authors = ["Your Name <your.email@example.com>"]
channels = [
    "https://brainvisa.info/neuro-forge",
    "pytorch",
    "nvidia",
    "conda-forge"
]
platforms = ["linux-64"]

[dependencies]
python = ">=3.8"
soma-env = ">=0.0"
libjpeg-turbo = ">=3.0"
pip = "*"

[pypi-dependencies]
dracopy = ">=1.4.2"

[tasks]
# Clone Git repositories
clone-repos = "git clone https://github.com/neurospin/deep_folding.git deep_folding 2>/dev/null || echo 'deep_folding already exists' && git clone https://github.com/neurospin/champollion_V1.git champollion_V1 2>/dev/null || echo 'champollion_V1 already exists'"

# Install deep_folding in editable mode
install-deep-folding = "cd deep_folding && git checkout 2025_bdrabczuk_running_local_tests && SKLEARN_ALLOW_DEPRECATED_SKLEARN_PACKAGE_INSTALL=True pip install -e ."

# Install champollion_V1 in editable mode
install-champollion = "cd champollion_V1 && pip install -e ."

# Create data directory
setup-data = "mkdir -p data"

# Global task to install everything
install-all = { depends-on = ["clone-repos", "install-deep-folding", "install-champollion", "setup-data"] }

# Uninstall task: removes cloned repos, installed packages, and data
uninstall = """
    rm -rf deep_folding champollion_V1 && \
    rm -rf data && \
    pip uninstall -y dracopy deep_folding champollion_V1 && \
    echo "Uninstallation complete."
"""

# Uninstall everything, including Pixi-managed dependencies
uninstall-all = """
    rm -rf .pixi pixi.lock && \
    pixi run uninstall
"""
